<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>TM14.Networking: TM14.Networking Quick Help</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">TM14.Networking
   &#160;<span id="projectnumber">v1.1.1</span>
   </div>
   <div id="projectbrief">Quick and simple implementation of TcpClient and TcpListener with a Packet data contract for data exchange, a PacketBuffer for orderly data exchange, and encryption features for secure data exchange.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('a00170.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="a00051.html">TM14.Networking</a> Quick Help </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This library contains wrapper classes around the <code>System.Net.Sockets.TcpClient</code> and <code>System.Net.Sockets.TcpListener</code> classes to make rapid use of those classes to transfer data between applications.</p>
<p>In order to make quick usage of the data transfer functionality, a <code>Packet</code> class has been included so that structured data contracts can be created between a client and server program.</p>
<p>A <code>PacketBuffer</code> class is included to ensure every packet is sent and received reliably, with no malformed parts being parsed.</p>
<p>It is written against .Net Standard 2.0 so that it can be used in your .Net Framework, .Net Core, and .Net 5 applications.</p>
<p>This library makes use of JSON and as such, utilizes <code>Newtonsoft.Json</code> as a dependency from NuGet.</p>
<p>There is a detailed <a href="https://networking.tm14.net/">documentation</a> website if you need more guidance. There, you can find a full guide on the <a href="https://networking.tm14.net/a00051.html">Classes</a> and <a href="https://networking.tm14.net/a00052.html">Events</a> this library provides.</p>
<p>This project is open source on <a href="https://github.com/mnwachukwu/TM14.Networking">Github</a>, if you're interested in looking at the code base. You can also find a download link to the .dll under the <a href="https://github.com/mnwachukwu/TM14.Networking/releases">Releases</a> section on Github if you prefer to just use the compiled assembly in your project.</p>
<p>Copyright &copy; <a href="https://tm14.net/">Studio TM14</a></p>
<h1><a class="anchor" id="autotoc_md4"></a>
Example Usage</h1>
<p><em>Note: You must properly configure the <code>SecretKey</code> of your application(s) before the code in this example will work. Refer to the <b>Security</b> section of this documentation (below this section) for more information.</em></p>
<h2><a class="anchor" id="autotoc_md5"></a>
Client</h2>
<h3><a class="anchor" id="autotoc_md6"></a>
Initialize</h3>
<div class="fragment"><div class="line"><span class="comment">// Initialize the TcpClient somewhere</span></div>
<div class="line">var tcpClient = <span class="keyword">new</span> TcpClient(ServerIp, ServerPort);</div>
<div class="line">tcpClient.HasPacket += TcpClient_HasPacket;</div>
<div class="line">tcpClient.Connect();</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md7"></a>
Sending data</h3>
<div class="fragment"><div class="line"><span class="comment">// Example method to build and send packets of data</span></div>
<div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">void</span> SendData(<span class="keywordtype">string</span> packetHeader, params <span class="keywordtype">string</span>[] packetData)</div>
<div class="line">{</div>
<div class="line">    var packet = <span class="keyword">new</span> Packet(packetHeader, packetData);</div>
<div class="line">    tcpClient.SendData(packet);</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md8"></a>
Receiving data</h3>
<div class="fragment"><div class="line"><span class="comment">// Example TcpClient_HasPacket event handler</span></div>
<div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keywordtype">void</span> TcpClient_HasPacket(<span class="keywordtype">object</span> sender, HasPacketEventArgs e)</div>
<div class="line">{</div>
<div class="line">    HandlePacket(e.Packet);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Example HandlePacket method (called from the event handler)</span></div>
<div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keywordtype">void</span> HandlePacket(Packet packet)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">switch</span> (packet.Header.ToLower())</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">case</span> <span class="stringliteral">&quot;a data header here&quot;</span>:</div>
<div class="line">            <span class="comment">// Do something with the packet data</span></div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md9"></a>
Server</h2>
<h3><a class="anchor" id="autotoc_md10"></a>
Initialize</h3>
<div class="fragment"><div class="line"><span class="comment">// Initialize the TcpServer somewhere</span></div>
<div class="line">var tcpServer = <span class="keyword">new</span> TcpServer(ServerIp, ServerPort);</div>
<div class="line">tcpServer.HasPacket += TcpServer_HasPacket;</div>
<div class="line">tcpServer.StartListener();</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md11"></a>
Sending data</h3>
<div class="fragment"><div class="line"><span class="comment">// Example method to build and send packets of data</span></div>
<div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">void</span> SendData(System.Net.Sockets.TcpClient client, <span class="keywordtype">string</span> packetHeader, params <span class="keywordtype">string</span>[] packetData)</div>
<div class="line">{</div>
<div class="line">    var packet = <span class="keyword">new</span> Packet(packetHeader, packetData);</div>
<div class="line">    tcpServer.SendDataTo(client, packet);</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md12"></a>
Receiving data</h3>
<div class="fragment"><div class="line"><span class="comment">// Example TcpServer_HasPacket event handler</span></div>
<div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keywordtype">void</span> TcpServer_HasPacket(<span class="keywordtype">object</span> sender, HasPacketEventArgs e)</div>
<div class="line">{</div>
<div class="line">    HandlePacket(e.Sender, e.Packet);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Example HandlePacket method (called from the event handler)</span></div>
<div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keywordtype">void</span> HandlePacket(System.Net.Sockets.TcpClient client, Packet packet)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">switch</span> (packet.Header.ToLower())</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">case</span> <span class="stringliteral">&quot;a data header here&quot;</span>:</div>
<div class="line">            <span class="comment">// Do something with the packet data</span></div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md13"></a>
Security</h1>
<h2><a class="anchor" id="autotoc_md14"></a>
Setting a SecretKey</h2>
<p>Within the <code>DataTransferProtocol</code> class, there is a member called <code>SecretKey</code> intended to secure trafic created by this library via encryption. It can't be null or empty and it must be able to be converted from a base 64 <code>string</code> to a <code>byte[32]</code>.</p>
<p><code>SecretKey</code> can easily be set by calling the <code>DataTransferProtocol.SetSecretKey()</code> method.</p>
<p><code>SecretKey</code> is defined as an <code>internal static string</code> so that you may use external secure mechanisms to set the value. It could also be defined as an <code>internal const string</code> so that you can set it in code, rather than during run-time. However, unless your application is obfuscated (encrypting or hiding away constant values), this compromises the network security of your application. This approach also breaks the <code>DataTransferProtocol.SetSecretKey()</code> method, but it can just be deleted.</p>
<p>The client and server applications implementing this library must have the same <code>SecretKey</code> when communicating with each other or else, they will not be able to decrypt each other's traffic.</p>
<h2><a class="anchor" id="autotoc_md15"></a>
Generating a SecretKey</h2>
<p>If you're looking for an easy way to get a secret key to use that's compatible with this library, consider the following method.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">void</span> GenerateUsableKey()</div>
<div class="line">{</div>
<div class="line">    var key = NewKey();</div>
<div class="line">    var keyString = Convert.ToBase64String(key);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// You want to use the value of `keyString` as your SecretKey</span></div>
<div class="line">    Console.WriteLine($<span class="stringliteral">&quot;Key As String: {keyString}&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p>This method is not included in the library but, it can be implemented into your copy of the library or, retooled to be used outside of the library in order to generate a secret key for your application.</p>
<h1><a class="anchor" id="autotoc_md16"></a>
Handling Exceptions</h1>
<p>As a philosophy, I don't think that exceptions in the networking layer should crash an application. Especially not a server application. This library will "swallow" exceptions thrown by it while handling data, disconnecting clients as needed.</p>
<p>However, you may wish to utilize the exceptions that are thrown by this library. You may want to log errors, or use the exception to break code execution. If this is desired, you can hook into an event either on the client or the server (or both) called <code>HasCaughtException</code>. This event, when raised, exposes any exceptions thrown by the networking library during data transmission.</p>
<h2><a class="anchor" id="autotoc_md17"></a>
Client Example</h2>
<div class="fragment"><div class="line">var tcpClient = <span class="keyword">new</span> TcpClient(ServerIp, ServerPort);</div>
<div class="line">tcpClient.HasCaughtException += TcpClient_HasCaughtException;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keywordtype">void</span> TcpClient_HasCaughtException(<span class="keywordtype">object</span> sender, HasCaughtExceptionEventArgs e)</div>
<div class="line">{</div>
<div class="line">    Console.WriteLine($<span class="stringliteral">&quot;{e.TimeStamp:g} {e.Exception.Message}&quot;</span>);</div>
<div class="line">    <span class="keywordflow">throw</span> e.Exception;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md18"></a>
Server Example</h2>
<div class="fragment"><div class="line">var tcpServer = <span class="keyword">new</span> TcpServer(ServerIp, ServerPort);</div>
<div class="line">tcpServer.HasCaughtException += TcpServer_HasCaughtException;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keywordtype">void</span> TcpServer_HasCaughtException(<span class="keywordtype">object</span> sender, HasCaughtExceptionEventArgs e)</div>
<div class="line">{</div>
<div class="line">    Console.WriteLine($<span class="stringliteral">&quot;{e.TimeStamp:g} {e.Exception.Message}&quot;</span>);</div>
<div class="line">    <span class="keywordflow">throw</span> e.Exception;</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
